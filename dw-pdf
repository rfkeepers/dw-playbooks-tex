#!/usr/bin/env bash
set -euo pipefail

# DW Playbook PDF Generator - Convenience Wrapper
# This script automatically pulls and runs the Docker image for generating DW playbook PDFs
# 
# Usage: dw-pdf <version> <mode> <input.tex> <output.pdf>
# - version: 1 or 2 (for DW 1 or DW 2)
# - mode: l or d (for light or dark mode)  
# - input.tex: source tex file
# - output.pdf: output PDF file
#
# Examples:
#   dw-pdf 1 l my_playbook.tex output.pdf     # DW1 in light mode
#   dw-pdf 2 d my_playbook.tex dark_book.pdf  # DW2 in dark mode

IMAGE_NAME="ghcr.io/ryankeepers/dw-playbooks-tex:latest"

# Check if Docker is installed
if ! command -v docker &> /dev/null; then
    echo "‚ùå Error: Docker is not installed or not in PATH"
    echo "Please install Docker first: https://docs.docker.com/get-docker/"
    exit 1
fi

# Check if Docker daemon is running
if ! docker info &> /dev/null; then
    echo "‚ùå Error: Docker daemon is not running"
    echo "Please start Docker and try again"
    exit 1
fi

# Pull the latest image (suppress output unless there's an error)
echo "üì¶ Pulling latest DW Playbooks image..."
if ! docker pull "$IMAGE_NAME" 2>/dev/null; then
    echo "‚ö†Ô∏è  Warning: Could not pull latest image, using local version if available"
fi

# Run the Docker container with all arguments passed through
docker run --rm -v "$(pwd):/tex" "$IMAGE_NAME" "$@"
